#Mandatory macros:
# CONTROLLER  ACP40

record (bi, "$(SENSOR):READ-STATUS")
{
# reads ONOFFG (SEN), STATUS and PRESSURE (PRX)  of all sensors
    field (DTYP, "stream")
    field (INP,  "@ACP40.proto read_status($(ADDR),$(SENSOR)) $(PORT)")
    field (PRIO, "MEDIUM")
    field (PINI, "YES")
    field (SCAN, "$(FASTSCAN=1 second)")
    field (ASG,  "READONLY")
}

record (ai, "$(SENSOR):READ-ADDR")
{
    field (DTYP, "stream")
    field (INP, "@ACP40.proto read_address($(ADDR),$(SENSOR)) $(PORT)")
    #field (SCAN, "$(FASTSCAN=1 second)")
}

record (ao, "$(SENSOR):SET-ADDR")
{
    field (DTYP, "stream")
    field (OUT, "@ACP40.proto set_address($(ADDR),$(SENSOR)) $(PORT)")
}

record (calc, "$(SENSOR):PUMP_ROTATION_SPEED")
{
    #field (INPB, "$(SENSOR):STATUS CP MS")
    field (CALC, "A")
    field (EGU,  "min-1")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

record (calc, "$(SENSOR):MOTOR_POWER")
{
    #field (INPB, "$(SENSOR):STATUS$(CH) CP MS")
    field (CALC, "A")
    field (EGU,  "Watt")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

record (calc, "$(SENSOR):RESERVED")
{
    #field (INPB, "$(SENSOR):STATUS$(CH) CP MS")
    field (CALC, "A")
    field (EGU,  "None")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

record (calc, "$(SENSOR):FREQUENCY_CONVERTER_TEMP")
{
    #field (INPB, "$(SENSOR):STATUS$(CH) CP MS")
    field (CALC, "A")
    field (EGU,  "Celsius")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

record (calc, "$(SENSOR):RESERVER")
{
    #field (INPB, "$(SENSOR):STATUS$(CH) CP MS")
    field (CALC, "A")
    field (EGU,  "None")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

record (calc, "$(SENSOR):PUMP_OPERATING_TIME")
{
    #field (INPB, "$(SENSOR):STATUS$(CH) CP MS")
    field (CALC, "A")
    field (EGU,  "hour")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

record (calc, "$(SENSOR):STATUS")
{
    #field (INPB, "$(SENSOR):STATUS$(CH) CP MS")
    field (CALC, "A")
    field (EGU,  "None")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

record (calcout, "$(SENSOR):STATUS-PUMP_RUNNING-UPDATER")
{
    field (INPA, "$(SENSOR):STATUS CP")
    field (CALC, "(A>>3)%2")
    field (OUT,  "$(SENSOR):STATUS-PUMP_RUNNING PP")
    field (ASG,  "READONLY")
}

record (bi, "$(SENSOR):STATUS-PUMP_RUNNING")
{
    field (ZNAM, "Pump stopped")
    field (ONAM, "Pump running")
}

record (calcout, "$(SENSOR):STATUS-SPEEDMODE-UPDATER")
{
    field (INPA, "$(SENSOR):STATUS CP")
    field (CALC, "(A>>2)%2")
    field (OUT,  "$(SENSOR):STATUS-SPEEDMODE PP")
    field (ASG,  "READONLY")
}

record (bi, "$(SENSOR):STATUS-SPEEDMODE")
{
    field (ZNAM, "set speed set point")
    field (ONAM, "set nominal speed")
}

record (calcout, "$(SENSOR):STATUS-whetherSPEEDREACHED-UPDATER")
{
    field (INPA, "$(SENSOR):STATUS CP")
    field (CALC, "(A>>1)%2")
    field (OUT,  "$(SENSOR):STATUS-whetherSPEEDREACHED PP")
    field (ASG,  "READONLY")
}

record (bi, "$(SENSOR):STATUS-whetherSPEEDREACHED")
{
    field (ZNAM, "Not reached")
    field (ONAM, "Stand-by speed reached")
}

record (bi, "$(SENSOR):whetherMOTOR_CURRENT_TOOHIGH")
{
    field (ZNAM, "Normal")
    field (ONAM, "Motor current too high.")
}

record (calc, "$(SENSOR):FAULT")
{
    field (CALC, "A")
    field (EGU, "None")
    field (ASG, "READONLY")
}

record (calcout, "$(SENSOR):FAULT-POWER_TRANSISTOR_POWERED-UPDATER")
{
    field (INPA, "$(SENSOR):FAULT CP")
    field (CALC, "(A>>5)%2")
    field (OUT,  "$(SENSOR):FAULT-POWER_TRANSISTOR_POWERED PP")
    field (ASG,  "READONLY")
}

record (bi, "$(SENSOR):FAULT-POWER_TRANSISTOR_POWERED")
{
    field (ZNAM, "Normal")
    field (ONAM, "NOT Powered")
}

record (calcout, "$(SENSOR):FAULT-MOTOR_TEMP_TOOHIGH-UPDATER")
{
    field (INPA, "$(SENSOR):FAULT CP")
    field (CALC, "(A>>4)%2")
    field (OUT,  "$(SENSOR):FAULT-MOTOR_TEMP_TOOHIGH PP")
    field (ASG,  "READONLY")
}

record (bi, "$(SENSOR):FAULT-MOTOR_TEMP_TOOHIGH")
{
    field (ZNAM, "Normal")
    field (ONAM, "Too high")
}

record (calcout, "$(SENSOR):FAULT-MOTOR_CURRENT_TOOHIGH-UPDATER")
{
    field (INPA, "$(SENSOR):FAULT CP")
    field (CALC, "(A>>3)%2")
    field (OUT,  "$(SENSOR):FAULT-MOTOR_CURRENT_TOOHIGH PP")
    field (ASG,  "READONLY")
}

record (bi, "$(SENSOR):FAULT-MOTOR_CURRENT_TOOHIGH")
{
    field (ZNAM, "Normal")
    field (ONAM, "Too high")
}


record (calc, "$(SENSOR):ALERT")
{
    #field (INPB, "$(SENSOR):STATUS$(CH) CP MS")
    field (CALC, "A")
    field (EGU,  "None")
    #field (PREC, "$(PREC=-4)")
    #field (LOPR, "1e$(MIN=-11)")
    #field (HOPR, "1e$(MAX=3)")
    #field (HIGH, "$(WARN=Inf)")
    #field (HSV,  "MINOR")
    #field (HIHI, "$(ALARM=Inf)")
    #field (HHSV, "MAJOR")
    field (ASG,  "READONLY")
}

#record (mbbi, "$(SENSOR):STATUS$(CH)")
#{
#    field (ZRST, "OK")
#    field (ONST, "UNDERRANGE")
#    field (TWST, "OVERRANGE")    field (TWSV, "MINOR")
#    field (THST, "SENSOR ERROR") field (THSV, "INVALID")
#    field (FRST, "SENSOR OFF")   field (FRSV, "INVALID")
#    field (FVST, "NO SENSOR")    field (FVSV, "INVALID")
#    field (SXST, "ID ERROR")     field (SXSV, "INVALID")
#    field (SVST, "I/O ERROR")    field (SVSV, "INVALID")
#    field (ASG,  "READONLY")
#}

#record (mbbi, "$(SENSOR):ONOFFG$(CH)")
#{
#    field (DTYP, "Raw Soft Channel")
#    field (ZRVL, "1")  field (ZRST, "OFF")
#    field (ONVL, "2")  field (ONST, "ON")
#    field (TWVL, "0")  field (TWST, "not switchable")
#    field (ASG,  "READONLY")
#}

record (bo, "$(SENSOR):ONOFF")
{
    field (ZNAM, "OFF")
    field (ONAM, "ON")
    field (DTYP, "stream")
    field (OUT,  "@ACP40.proto set_onoff($(ADDR),$(SENSOR)) $(PORT)")
    field (PRIO, "HIGH")
    field (ASG,  "$(ASG=)")
    #field (SDIS, "$(SENSOR):ONOFFG$(CH)") field (DISV, "2") # don't write if not switchable
}


